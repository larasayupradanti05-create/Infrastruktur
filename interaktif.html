<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Interaktif Jalan UPNVJT</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:'Poppins',sans-serif;background:#f8f9fa;}
.sidebar{height:100vh;width:250px;background:#0d6efd;color:white;position:fixed;padding:1rem;display:flex;flex-direction:column;}
.sidebar h4{text-align:center;margin-bottom:2rem;font-weight:700;}
.sidebar a{color:#dbe4ff;text-decoration:none;padding:10px 15px;margin-bottom:5px;border-radius:8px;display:block;transition:0.2s;}
.sidebar a:hover,.sidebar a.active{background:#ffffff22;color:#fff;}
.main-content{margin-left:260px;padding:2rem;}
.card{border-radius:1rem;box-shadow:0 4px 15px rgba(0,0,0,0.05);margin-bottom:1.5rem;padding:1rem;}
.chart-container{width:100%;max-width:900px;margin:2rem auto;}
</style>
</head>
<body>

<div class="sidebar">
<h4><i class="bi bi-geo-alt-fill"></i> Jalan UPNVJT</h4>
<a href="index.html">Dashboard</a>
<a href="data-responden.html">Data Responden</a>
<a href="analisis 1.html">Analisis</a>
<a href="ringkasan.html">Ringkasan</a>
<a href="#" class="active">Interaktif</a>
<a href="#"><i class="bi bi-info-circle me-2"></i> Tentang</a>
</div>

<div class="main-content">
<h2 class="fw-bold mb-4 text-primary">Dashboard Interaktif Survei Jalan</h2>

<div class="mb-3">
<input type="file" id="csvFile" accept=".csv" hidden>
</div>

<div class="row g-3 mb-3">
<div class="col-md-6">
<label for="scoreMin">Range Skor Minimal</label>
<input type="number" id="scoreMin" class="form-control" value="0" min="0" max="5">
</div>
<div class="col-md-6">
<label for="scoreMax">Range Skor Maksimal</label>
<input type="number" id="scoreMax" class="form-control" value="5" min="0" max="5">
</div>
</div>

<div class="row g-4">
<div class="col-md-6">
<div class="card">
<h5>Total Responden</h5>
<h3 id="totalResponden">0</h3>
</div>
</div>
<div class="col-md-6">
<div class="card">
<h5>Rata-rata Kepuasan</h5>
<h3 id="avgKepuasan">0.0</h3>
</div>
</div>
</div>

<div class="chart-container">
<canvas id="chart"></canvas>
</div>

<p id="infoText" class="text-danger fw-bold"></p>
</div>

<script>
let csvData = [];
let chartInstance = null;

const csvFile = document.getElementById("csvFile");
const totalResponden = document.getElementById("totalResponden");
const avgKepuasan = document.getElementById("avgKepuasan");
const infoText = document.getElementById("infoText");
const scoreMin = document.getElementById("scoreMin");
const scoreMax = document.getElementById("scoreMax");
const ctx = document.getElementById("chart").getContext("2d");

// Load CSV
csvFile.addEventListener("change", function(e){
    const file = e.target.files[0];
    Papa.parse(file,{
        header:true,
        skipEmptyLines:true,
        complete:function(results){
            csvData = results.data;
            localStorage.setItem("surveyData", JSON.stringify(csvData));
            updateDashboard();
        }
    });
});

// Ambil dari localStorage jika pindah halaman
if(localStorage.getItem("surveyData")){
    csvData = JSON.parse(localStorage.getItem("surveyData"));
    updateDashboard();
}

// Update saat filter berubah
scoreMin.addEventListener("input", updateDashboard);
scoreMax.addEventListener("input", updateDashboard);

function updateDashboard(){
    if(csvData.length===0){
        infoText.textContent = "⚠️ Data belum dimuat. Upload CSV terlebih dahulu.";
        return;
    }
    infoText.textContent = "";

    const min = parseFloat(scoreMin.value) || 0;
    const max = parseFloat(scoreMax.value) || 5;

    // Filter data
    let filtered = csvData.filter(r=>{
        const skor = parseFloat(r[Object.keys(r)[8]]) || 0;
        return skor>=min && skor<=max;
    });

    totalResponden.textContent = filtered.length;

    const kepuasanArr = filtered.map(r=>parseFloat(r[Object.keys(r)[18]])||0);
    const avg = kepuasanArr.length>0 ? (kepuasanArr.reduce((a,b)=>a+b,0)/kepuasanArr.length).toFixed(2) : 0;
    avgKepuasan.textContent = avg;

    // Buat chart
    const labels = filtered.map((r,i)=>`Responden ${i+1}`);
    const dataVals = filtered.map(r=>parseFloat(r[Object.keys(r)[8]])||0);

    if(chartInstance) chartInstance.destroy();
    chartInstance = new Chart(ctx,{
        type:'bar',
        data:{
            labels:labels,
            datasets:[{
                label:'Skor Kondisi Jalan',
                data:dataVals,
                backgroundColor:'rgba(13,110,253,0.7)',
                borderColor:'rgba(13,110,253,1)',
                borderWidth:1
            }]
        },
        options:{
            responsive:true,
            plugins:{ legend:{ display:true }, tooltip:{ enabled:true } },
            scales:{ y:{ beginAtZero:true } }
        }
    });
}
</script>

</body>
</html>
